# K8s简明指南

## K8s是什么？
Kubernetes（简称 K8s）是一个开源的容器编排平台，用于自动化应用容器的部署、扩展和管理。它最初由 Google 开发，并于 2014 年开源，目前由 Cloud Native Computing Foundation (CNCF) 进行维护。Kubernetes 是构建现代分布式应用程序的核心工具之一，特别是在云原生架构中。

核心功能
- **容器编排**： Kubernetes 能够管理成千上万个容器，并为其提供调度和运行环境。
- **服务发现与负载均衡**： 自动为容器分配 IP，并支持服务发现，提供内置负载均衡功能。
- **自动扩展和自愈能力**：
   - 根据资源需求和流量负载，自动扩展或缩减应用实例。
   - 检测并重启失败的容器，确保系统健康运行。
- **配置管理与私密信息管理**： 无需重新构建镜像，即可更新应用配置；同时安全地管理敏感信息（如密码和密钥）。
- **存储编排**： 支持挂载本地存储、云存储（如 AWS EBS、Google Persistent Disk）、网络存储（如 NFS）。
- **滚动更新和回滚**： 应用可以逐步更新，减少对用户的影响；在问题发生时可以快速回滚。

## K8s的核心组件
### 控制平面组件（Control Plane）

控制平面负责管理整个集群的工作，包括调度、监控、决策等。所有的控制平面组件通常运行在主节点（Master Node）上。

#### 1. API Server (`kube-apiserver`)
- **功能**：作为 Kubernetes 集群的入口，处理所有的 RESTful API 请求，所有的 Kubernetes 操作都通过它来进行。
- **作用**：提供集群的管理接口，接收并处理用户请求，访问和更新集群的状态。

#### 2. etcd
- **功能**：一个分布式的键值存储系统。
- **作用**：存储集群的所有数据，如节点、Pod、配置等。确保 Kubernetes 配置和状态数据的可靠性与一致性。

#### 3. Scheduler (`kube-scheduler`)
- **功能**：将待调度的 Pod 分配到适当的工作节点上。
- **作用**：根据资源要求、节点的负载、拓扑等因素选择一个合适的节点来运行 Pod。

#### 4. Controller Manager (`kube-controller-manager`)
- **功能**：负责集群的控制循环，确保集群的目标状态与实际状态一致。
- **作用**：运行各种控制器，如副本控制器、部署控制器、节点控制器等，确保应用的副本数量、资源分配、健康状态等符合期望。

#### 5. Cloud Controller Manager（可选）
- **功能**：与云服务平台（如 AWS、GCP）进行交互，管理云资源。
- **作用**：管理云负载均衡器、云存储、节点生命周期等。

### 工作节点组件（Node Components）

工作节点运行容器化的应用程序，每个节点包含以下核心组件。

#### 1. Kubelet
- **功能**：每个节点上的主要代理，负责管理 Pod 和容器的生命周期。
- **作用**：与 API Server 通信，确保容器按预期运行，并上报健康状态。

#### 2. Kube-proxy
- **功能**：为 Kubernetes 服务提供负载均衡和网络代理功能。
- **作用**：确保流量能够被路由到集群中正确的 Pod，实现服务的访问控制和负载均衡。

#### 3. 容器运行时（Container Runtime）
- **功能**：实际运行容器的底层工具。
- **作用**：管理容器的生命周期，包括启动、停止和删除容器。常见的容器运行时包括 Docker、containerd 和 CRI-O。

### 附加组件（Add-ons）

这些组件通常不是核心组件，但在生产环境中常常被用来扩展和增强 Kubernetes 的功能。

#### 1. DNS（CoreDNS）
- **功能**：为 Kubernetes 集群内的服务和 Pod 提供名称解析。
- **作用**：通过内部 DNS 服务，实现基于名称的服务发现。

#### 2. Dashboard
- **功能**：提供一个 Web 界面来管理和监控 Kubernetes 集群。
- **作用**：用户可以通过 Dashboard 查看集群状态、管理部署、检查 Pod 健康等。

#### 3. Ingress Controller
- **功能**：管理外部 HTTP/HTTPS 流量的入口规则。
- **作用**：控制和配置外部流量如何进入 Kubernetes 集群，并分发到适当的服务。

#### 4. 网络插件（CNI 插件）
- **功能**：管理 Pod 间的网络通信和网络策略。
- **作用**：通过 CNI 插件（如 Calico、Flannel 等）提供 Pod 之间的网络隔离、路由和安全策略。

#### 5. 存储插件（CSI 插件）
- **功能**：与存储系统进行集成，提供持久化存储支持。
- **作用**：支持各种存储后端，如本地存储、云存储等。

